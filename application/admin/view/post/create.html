{layout name='base'}

<div class="card alert">
    <div class="card-body">
        <form class="form-horizontal" method="post" action="/post/save">
            <input type="text" hidden name="id" value="{$post['id']|default=''}">

            <div class="form-group">
                <label class="col-sm-1 control-label">标题</label>
                <div class="col-sm-11">
                    <input type="text" class="form-control" value="{$post['title']|default=''}" name="title"
                           placeholder="请输入标题，15个字以内">
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-1 control-label">简介</label>
                <div class="col-sm-11">
                    <input type="text" class="form-control" value="{$post['intro']|default=''}" name="intro"
                           placeholder="请输入内容，150个字以内">
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-1 control-label">选择分类</label>
                <div class="col-sm-11">
                    <select class="form-control" name="classify_id">
                        {if $currentClassify!=''}
                        <option value="{$currentClassify.id}">{$currentClassify.name}</option>
                        {/if}
                        {volist name='classify_list' id='classify'}
                        {if $classify.name!=$currentClassify.name}
                        <option value="{$classify.id}">{$classify.name}</option>
                        {/if}
                        {/volist}
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">内容</label>
                        <div class="col-sm-10">
                            <textarea style="height: 400px;" name="body" class="form-control body"
                                      placeholder="markdown语法">{$post.body|default=''}</textarea>
                            <hr>
                            <div class="btn-group btn-group-xs">
                                <button class="btn btn-success update_img" type="button">上传图片</button>
                                <button class="btn btn-default" type="button">上传截图</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-sm-6" style="height: 400px;overflow: auto">
                    <div class="html">

                    </div>
                </div>
            </div>

            <button class="btn btn-success" type="submit">保存</button>
        </form>
    </div>
</div>

<script>
    $(function () {
        /*内容*/
        let converter = new showdown.Converter();
        $(".body").on("input propertychange", function () {
            let html = converter.makeHtml($(this).val());
            $(".html").html(html);

            $(".html pre code").each((index,element)=>{
                $(element).css("background",'#f5f5f5');
                hljs.highlightBlock(element);
            });
        });

        $('form').bootstrapValidator({
            feedbackIcons: {
                valid: 'ti-check',
                invalid: 'ti-close',
                validating: 'ti-alert'
            },
            fields: {
                title: {
                    validators: {
                        notEmpty: {
                            message: '标题不能为空'
                        },
                        stringLength: {
                            max: 100,
                            message: '最多设置100个字符'
                        },
                    }
                },
                intro: {
                    validators: {
                        notEmpty: {
                            message: '简介不能为空'
                        },
                        stringLength: {
                            max: 150,
                            message: '最多设置150个字符'
                        },
                    }
                },
                classify_id: {
                    validators: {
                        notEmpty: {
                            message: '分类不能为空，请先创建一个分类'
                        }
                    }
                }
            }
        });
    });
</script>
